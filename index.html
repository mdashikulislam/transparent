<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.84.0">
    <title>Transparent Propaganda</title>
    <link rel="shortcut icon" href="assets/images/Logo.png" type="image/x-icon">
    <!-- Bootstrap core CSS -->
    <link href="assets/dist/css/bootstrap.min.css" rel="stylesheet">

    <script src="assets/dist/js/jquery-3.5.1.js"></script>
    <script src="assets/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom styles for this template -->
    <link href="style.css" rel="stylesheet">
    <link href="responsive.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/dist/css/bootstrap-select.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
          rel="stylesheet">
    <link rel="stylesheet" href="assets/dist/css/sweetalert2.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link href="https://transpanda.news/assets/css/flag-icon.css" rel="stylesheet">
</head>
<body>
<main>
    <nav class="navbar navbar-expand-sm" aria-label="Third navbar example">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html"><img src="assets/images/Logo.png" alt=""></a>
            <div class="header-date-1">
                <input type="text" class="form-control" id="datepicker">
            </div>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample03"
                    aria-controls="navbarsExample03" aria-expanded="false" aria-label="Toggle navigation">
                <i class="bi bi-list"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarsExample03">
                <ul class="navbar-nav ms-auto mb-2 mb-sm-0">
                    <li class="nav-item Who-are-we-menu">
                        <a class="nav-link" href="#">Who are we?</a>
                    </li>
                    <li class="nav-item search-icon-menu">
                        <i class="bi bi-search"></i>
                    </li>
                    <li class="nav-item lng-menu">
                        EN
                    </li>
                    <li class="nav-item donation-menu">
                        <a class="nav-link" href="#">MAKE A DONATION</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <section class="home-section-1">
        <div class="container">
            <div class="home-section-1-1">
                <div class="home-section-1-left-arror">
                    <button id="left-button">
                        <i class="bi bi-caret-left"></i>
                    </button>
                </div>
                <ul class="home-section-1-sub-1" id="keyword-list">
                </ul>
                <div class="home-section-1-right-arror ms-auto">
                    <button id="right-button">
                        <i class="bi bi-caret-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <section class="home-section-2">
        <div class="container">
            <div class="row">
                <div class="col-md-6 home-section-2-1">
                    <h6>Country</h6>
                    <select data-side="left"  class="selectpicker" multiple aria-label="Default select example"
                            data-live-search="true">

                    </select>
                </div>
                <div class="col-md-6 home-section-2-1">
                    <h6>Country</h6>
                    <select data-side="right" class="selectpicker" multiple aria-label="Default select example"
                            data-live-search="true">

                    </select>
                </div>
            </div>
        </div>
    </section>

    <section class="home-section-3 large-screen">
        <div class="container">
            <div class="row">
                <div class="col-md-12 home-section-3-1">
                    <div class="timeline row">
                        <div class="col-md-6">
                            <div class="home-section-3-2 home-section-3-4">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="home-section-3-2 home-section-3-3">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="home-section-3 mobile-screen">
        <div class="container">
            <div class="row">
                <div class="col-md-12 home-section-3-1">
                    <div class="timeline row">
                        <div class="col-md-6">
                            <div class="home-section-3-2 home-section-3-4 home-section-mobile">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

</main>
<script src="assets/dist/js/sweetalert2.min.js"></script>
<script type="text/javascript" src="assets/dist/js/moment.min.js"></script>
<script type="text/javascript" src="assets/dist/js/daterangepicker.min.js"></script>
<script src="assets/dist/js/bootstrap-select.min.js"></script>
<script>

    new Swal({
        title: 'Please wait...',
        timerProgressBar: true,
    });
    Swal.showLoading();
    var keywordList;
    var countryListArray;
    var dateArray = [];
    var currentData = '';
    var initialValue = [];
    var activeKeyword = '';
    $(window).on('load', function () {
        initialValue = ajaxCall('https://transpanda.news/tpapi/rss_getinitvalues.cfm');
        currentData = initialValue[0][1].replaceAll('.','-');
        activeKeyword = initialValue[1][1];
        if (initialValue.length > 0){
            var globalContent = ajaxCall(`https://transpanda.news/tpapi/rss_getcontent.cfm?date=${currentData}&keyword=${initialValue[1][1]}&countrycode1=${initialValue[4][1]}&countrycode2=${initialValue[2][1]}&from=1&to=50`);
            if (globalContent.length > 0) {
                var contentHtmlLeft = '';
                var contentHtmlRight = '';
                var mobileContent = '';
                $.each(globalContent, function (key, val) {
                    mobileContent +=getCardBoth(val,key);
                    if (val[12] == 'L'){
                        contentHtmlLeft += getCardLeft(val);
                    }else{
                        contentHtmlRight += getCardRight(val);
                    }
                });
                $('.home-section-3-4').html(contentHtmlLeft);
                $('.home-section-3-3').html(contentHtmlRight);
                $('.home-section-mobile').html(mobileContent);
            }
        }
        Swal.close();
        keywordList = ajaxCall(`https://transpanda.news/tpapi/rss_getkeywords.cfm?date=${currentData}&countries=${[initialValue[4][1],initialValue[2][1]].toString()}`);
        if (keywordList.length > 0) {
            updateKeywordList(keywordList)
        }
        var dateList = ajaxCall('https://transpanda.news/tpapi/rss_getdates.cfm');
        if (dateList.length > 0) {
            $.each(dateList, function (key, val) {
                dateArray.push(val[0].replaceAll('.','-'));
            });
            $( "#datepicker" ).datepicker({
                beforeShowDay: function(date) {
                    var dateList = `${date.getFullYear()}-${("0" + (date.getMonth() + 1)).slice(-2)}-${("0" + (date.getDate())).slice(-2)}`;
                    if ($.inArray(dateList,dateArray) !== -1) {
                        return [true, ''];
                    }
                    return [false, ''];
                }
            });
        }else{
            $("#datepicker").datepicker();
        }
        var countryList = ajaxCall('https://transpanda.news/tpapi/rss_getcountries.cfm');
        if (countryList.length > 0) {
            var countryHtml = '';
            $.each(countryList, function (key, val) {
                countryHtml += `<option value="${val[1]}">${val[0]}</option>`;
            });
            $('.selectpicker').html(countryHtml);
            $('.selectpicker').selectpicker('refresh');
        }
    });
    $(document).ready(function () {
        $(document).on('change', '#datepicker', function () {
            //SwalInit();
            currentData = $(this).val().replaceAll('/','-');
            var contentUrl = `https://transpanda.news/tpapi/rss_getcontent.cfm?date=${currentData}`;
            if ($('.key-class.active').length > 0) {
                var newKeyword = [];
                $('.key-class').each(function () {
                    if ($(this).hasClass('active')) {
                        newKeyword.push($(this).data('value'))
                    }
                });
                contentUrl += `&keyword=${newKeyword.toString()}`;
            } else {
                contentUrl += `&keyword=${initialValue[1][1]}`;
            }
            var keywordUrl = `https://transpanda.news/tpapi/rss_getkeywords.cfm?date=${currentData}`;
            var allCountryKeyword = '';
            $('.selectpicker').each(function (){
                if ($(this).data('side') == 'left'){
                    if ($(this).val().length > 0){
                        contentUrl +=`&countrycode1=${$(this).val().toString()}`;
                        allCountryKeyword +=`${$(this).val().toString()}`;
                    }else{
                        contentUrl +=`&countrycode1=${initialValue[4][1]}`;
                        allCountryKeyword +=`${initialValue[4][1]}`;
                    }
                }else{
                    allCountryKeyword +=',';
                    if ($(this).val().length > 0){
                        contentUrl +=`&countrycode2=${$(this).val().toString()}`;
                        allCountryKeyword +=`${$(this).val().toString()}`;
                    }else{
                        contentUrl +=`&countrycode2=${initialValue[2][1]}`;
                        allCountryKeyword +=`${initialValue[2][1]}`;
                    }
                }
            });
            keywordUrl +=`&countries=${allCountryKeyword}`;
            contentUrl +=`&from=1&to=50`;

            var globalContent = ajaxCall(contentUrl);
            if (globalContent.length > 0) {
                var contentHtmlLeft = '';
                var contentHtmlRight = '';
                var mobileContent = '';
                $.each(globalContent, function (key, val) {
                    mobileContent +=getCardBoth(val,key);
                    if (val[12] == 'L'){
                        contentHtmlLeft += getCardLeft(val);
                    }else{
                        contentHtmlRight += getCardRight(val);
                    }
                });
                $('.home-section-3-4').html(contentHtmlLeft);
                $('.home-section-3-3').html(contentHtmlRight);
                $('.home-section-mobile').html(mobileContent);
            }

            keywordList = ajaxCall(keywordUrl);
            if (keywordList.length > 0) {
                updateKeywordList(keywordList);
            }
        })
        $(document).on('click', '.key-class', function () {
            $(this).toggleClass('active');
            var contentUrl = `https://transpanda.news/tpapi/rss_getcontent.cfm?date=${currentData}`;
            if ($('.key-class.active').length > 0) {
                var newKeyword = [];
                $('.key-class').each(function () {
                    if ($(this).hasClass('active')) {
                        newKeyword.push($(this).data('value'))
                    }
                });
                contentUrl += `&keyword=${newKeyword.toString()}`;
                activeKeyword = newKeyword.toString();
            } else {
                contentUrl += `&keyword=${initialValue[1][1]}`;
                activeKeyword = initialValue[1][1];
            }
            $('.selectpicker').each(function (){
                if ($(this).data('side') == 'left'){
                    if ($(this).val().length > 0){
                        contentUrl +=`&countrycode1=${$(this).val().toString()}`;
                    }else{
                        contentUrl +=`&countrycode1=${initialValue[4][1]}`;
                    }
                }else{
                    if ($(this).val().length > 0){
                        contentUrl +=`&countrycode2=${$(this).val().toString()}`;
                    }else{
                        contentUrl +=`&countrycode2=${initialValue[2][1]}`;
                    }
                }
            });
            contentUrl +=`&from=1&to=50`;

            var globalContent = ajaxCall(contentUrl);
            if (globalContent.length > 0) {
                var contentHtmlLeft = '';
                var contentHtmlRight = '';
                var mobileContent = '';
                $.each(globalContent, function (key, val) {
                    mobileContent +=getCardBoth(val,key);
                    if (val[12] == 'L'){
                        contentHtmlLeft += getCardLeft(val);
                    }else{
                        contentHtmlRight += getCardRight(val);
                    }
                });
                $('.home-section-3-4').html(contentHtmlLeft);
                $('.home-section-3-3').html(contentHtmlRight);
                $('.home-section-mobile').html(mobileContent);
            }
        });
        $(document).on('change', '.selectpicker', function () {
            var contentUrl = `https://transpanda.news/tpapi/rss_getcontent.cfm?date=${currentData}`;
            if ($('.key-class.active').length > 0) {
                var newKeyword = [];
                $('.key-class').each(function () {
                    if ($(this).hasClass('active')) {
                        newKeyword.push($(this).data('value'))
                    }
                });
                contentUrl += `&keyword=${newKeyword.toString()}`;
            } else {
                contentUrl += `&keyword=${initialValue[1][1]}`;
            }
            $('.selectpicker').each(function (){
                if ($(this).data('side') == 'left'){
                    if ($(this).val().length > 0){
                        contentUrl +=`&countrycode1=${$(this).val().toString()}`;
                    }else{
                        contentUrl +=`&countrycode1=${initialValue[4][1]}`;
                    }
                }else{
                    if ($(this).val().length > 0){
                        contentUrl +=`&countrycode2=${$(this).val().toString()}`;
                    }else{
                        contentUrl +=`&countrycode2=${initialValue[2][1]}`;
                    }
                }
            });
            contentUrl +=`&from=1&to=50`;
            var globalContent = ajaxCall(contentUrl);
            if (globalContent.length > 0) {
                var contentHtmlLeft = '';
                var contentHtmlRight = '';
                var mobileContent = '';
                $.each(globalContent, function (key, val) {
                    mobileContent +=getCardBoth(val,key);
                    if (val[12] == 'L'){
                        contentHtmlLeft += getCardLeft(val);
                    }else{
                        contentHtmlRight += getCardRight(val);
                    }
                });
                $('.home-section-3-4').html(contentHtmlLeft);
                $('.home-section-3-3').html(contentHtmlRight);
                $('.home-section-mobile').html(mobileContent);
            }
        })
    })

    function SwalInit() {
        new Swal({
            title: 'Please wait...',
            timerProgressBar: true,
        });
        Swal.showLoading();
    }
    function getCardBoth(data,key) {
        var side= 'left';
        if ((key % 2)==0){
             side= 'left';
        }else{
            side= 'right';
        }
        return `<div class="timeline-${side}-side-1">
                                    <div class="timeline-heading">
                                        <a href="${data[3]}"><h4 class="timeline-title">${data[0]}</h4></a>
                                        <p>${data[7]}</p>
                                        <div>
                                            <span class="flag-icon flag-icon-${data[6]}"></span>
                                        </div>
                                    </div>
                                    <div class="timeline-body">
                                        <p>${data[1]}</p>
                                        <h5>${data[8]}</h5>
                                        <h5>${moment(new Date(data[4])).fromNow()}</h5>
                                    </div>
                                    <div class="timeline-heading-sub-1">
                                        <a  class="check-global" href="check-global.html?link=${data[3]}&date=${currentData}&keyword=${activeKeyword}">Check global</a>
                                        <p class="share-icon-1"><a href="${data[3]}" target="_blank"><i class="bi bi-share-fill"></i></a></p>
                                        <h3 class="ms-auto"><i class="bi bi-circle-fill " style="color: ${data[10]}"></i>WPFI: ${data[9]}</h3>
                                    </div>
                                </div>`;
    }
    function getCardLeft(data) {
        return `<div class="timeline-left-side-1">
                                    <div class="timeline-heading">
                                        <a href="${data[3]}"><h4 class="timeline-title">${data[0]}</h4></a>
                                        <p>${data[7]}</p>
                                        <div>
                                            <span class="flag-icon flag-icon-${data[6]}"></span>
                                        </div>
                                    </div>
                                    <div class="timeline-body">
                                        <p>${data[1]}</p>
                                        <h5>${data[8]}</h5>
                                        <h5>${moment(new Date(data[4])).fromNow()}</h5>
                                    </div>
                                    <div class="timeline-heading-sub-1">
                                        <a  class="check-global" href="check-global.html?link=${data[3]}&date=${currentData}&keyword=${activeKeyword}">Check global</a>
                                        <p class="share-icon-1"><a href="${data[3]}" target="_blank"><i class="bi bi-share-fill"></i></a></p>
                                        <h3 class="ms-auto"><i class="bi bi-circle-fill " style="color: ${data[10]}"></i>WPFI: ${data[9]}</h3>
                                    </div>
                                </div>`;
    }
    function getCardRight(data) {
        return `<div class="timeline-right-side-1">
                                    <div class="timeline-heading">
                                        <a href="${data[3]}"><h4 class="timeline-title">${data[0]}</h4></a>
                                        <p>${data[7]}</p>
                                        <div>
                                            <span class="flag-icon flag-icon-${data[6]}"></span>
                                        </div>
                                    </div>
                                    <div class="timeline-body">
                                        <p>${data[1]}</p>
                                        <h5>${data[8]}</h5>
                                        <h5>${moment(new Date(data[4])).fromNow()}</h5>
                                    </div>
                                    <div class="timeline-heading-sub-1">
                                        <a  class="check-global" href="check-global.html?link=${data[3]}&date=${currentData}&keyword=${activeKeyword}">Check global</a>
                                        <p class="share-icon-1"><a href="${data[3]}" target="_blank"><i class="bi bi-share-fill"></i></a></p>
                                        <h3 class="ms-auto"><i class="bi bi-circle-fill " style="color: ${data[10]}"></i>WPFI: ${data[9]}</h3>
                                    </div>
                                </div>`;
    }
    function updateKeywordList(keywordList) {
        var keywordListHtml = '';
        $.each(keywordList, function (key, val) {
            if (val[0] !== '') {
                keywordListHtml += `<li class="key-class" data-value="${val[0]}">
                    <span>${val[0]}</span>
                    <i class="bi bi-x-lg"></i>
                  </li>`;
            }
        });
        $('#keyword-list').html(keywordListHtml);
    }
    function ajaxCall(url) {
        var data;
        $.ajax({
            url: url,
            method: 'GET',
            async: false,
            success: function (response) {
                data = response.DATA;
            }
        });
        return data;
    }

    $('#right-button').click(function () {
        event.preventDefault();
        $('.home-section-1-sub-1').animate({
            scrollLeft: "+=200px"
        }, "slow");
    });

    $('#left-button').click(function () {
        event.preventDefault();
        $('.home-section-1-sub-1').animate({
            scrollLeft: "-=200px"
        }, "slow");
    });

</script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.84.0">
    <title>Transparent Propaganda</title>
    <link rel="shortcut icon" href="assets/images/Logo.png" type="image/x-icon">
    <!-- Bootstrap core CSS -->
    <link href="assets/dist/css/bootstrap.min.css" rel="stylesheet">

    <script src="assets/dist/js/jquery-3.5.1.js"></script>
    <script src="assets/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom styles for this template -->
    <link href="style.css" rel="stylesheet">
    <link href="responsive.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/dist/css/bootstrap-select.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
          rel="stylesheet">
    <link rel="stylesheet" href="assets/dist/css/sweetalert2.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link href="https://transpanda.news/assets/css/flag-icon.css" rel="stylesheet">
    <script type='text/javascript' src='https://platform-api.sharethis.com/js/sharethis.js#property=625a7ea1742b6c001a1bdc3b&product=inline-share-buttons' async='async'></script>
</head>
<body>
<main>
    <nav class="navbar navbar-expand-sm" aria-label="Third navbar example">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html"><img src="assets/images/Logo.png" alt=""></a>
            <div class="header-date-1">

            </div>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample03"
                    aria-controls="navbarsExample03" aria-expanded="false" aria-label="Toggle navigation">
                <i class="bi bi-list"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarsExample03">
                <ul class="navbar-nav ms-auto mb-2 mb-sm-0">
                    <!--                     <li class="nav-item share-menu">
                                        <div class="sharethis-inline-share-buttons"></div>
                                        </li> -->
                    <li class="nav-item Who-are-we-menu">
                        <a class="nav-link" href="who-are-we.html">Who are we?</a>
                    </li>
                    <li class="nav-item search-icon-menu">
                        <i class="bi bi-search"></i>
                    </li>
                    <!--                     <li class="nav-item lng-menu">
                                            EN
                                        </li> -->
                    <li class="nav-item donation-menu">
                        <a class="nav-link" href="#">MAKE A DONATION</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container">
        <div class="row">
            <div class="col-12 text-center mt-5">
                <a class="btn btn-dark" href="index.html">zurück</a>
            </div>
        </div>
    </div>
    <section class="home-section-3">
        <div class="container">
            <div class="row">
                <div class="col-md-12 home-section-3-1 check-global-section-1-top">
                    <div class="timeline check-global-section-1">
                        <div class="check-global-section-3">

                        </div>
                        <div class="home-section-2-1 check-global-section-4">
                            <h6>Länderauswahl</h6>
                            <select class="selectpicker" multiple aria-label="Default select example"
                                    data-live-search="true">
                            </select>
                        </div>
                        <div class="check-global-section-2">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

</main>

<script src="assets/dist/js/sweetalert2.min.js"></script>
<script type="text/javascript" src="assets/dist/js/moment.min.js"></script>
<script type="text/javascript" src="assets/dist/js/daterangepicker.min.js"></script>
<script src="assets/dist/js/bootstrap-select.min.js"></script>

<script>
    new Swal({
        title: 'Please wait...',
        timerProgressBar: true,
    });
    Swal.showLoading();
    var header = [];
    var dateArray = [];
    var currentDate = '';
    var url = '';
    var keywordList = [];
    var activeKeyword = '';
    var allCountry = [];
    $(window).on('load', function () {
        url = getUrlParameter('link');
        if (url == '') {
            window.location.href = 'index.html';
        }
        header = ajaxCall(`https://transpanda.news/tpapi/rss_getcontentbylink.cfm?link=${url}`);
        currentDate = getUrlParameter('date');
        activeKeyword = getUrlParameter('keyword');
        if (header.length > 0) {
            var headerHtml = `<div class="timeline-left-side-1">
                <div class="timeline-heading">
                  <a href="${header[0][3]}"><h4 class="timeline-title">${header[0][0]}</h4></a>
                  <div class="check-global-section-1-1 ms-auto">
                    <p>${header[0][7]}</p>
                    <div>
                     <span class="flag-icon flag-icon-${header[0][6]}" style="width:30px;"></span>
                    </div>
                  </div>
                </div>
                <div class="timeline-body">
                  <p>${header[0][1]}</p>
                  <h5>${header[0][8]}</h5>
                  <h5>${moment(new Date(header[0][4])).fromNow()}</h5>
                </div>
                <div class="timeline-heading-sub-1">
                  <div class="sharethis-inline-share-buttons" data-title='Transpanda: ${header[0][0]}'></div>
                  <h3 class="ms-auto"><i class="bi bi-circle-fill" style="color: ${header[0][10]}"></i>WPFI: ${header[0][9]}</h3>
                </div>
              </div>`;
            $('.check-global-section-3').html(headerHtml);
            Swal.close();
        } else {
            $('body main .container').remove();
            $('body main').append(`<div class="container">
                    <div class="row justify-content-center">
                        <div class="col-12 col-lg-6">
                            <p style="text-align: center">Wilkommen auf transpanda.news - der Gegenüberstellung von globalen Nachrichten</p>
                        </div>
                    </div>
                </div>`);
            Swal.close();
        }
        var countryList = ajaxCall('https://transpanda.news/tpapi/rss_getcountries.cfm');

        if (countryList.length > 0) {
            var countryHtml = '';
            $.each(countryList, function (key, val) {
                if (val[1] != header[0][5]){
                    allCountry.push(val[1]);
                }
                countryHtml += `<option ${val[1] == header[0][5] ? '' :'selected'} value="${val[1]}">${val[0]}</option>`;
            });
            $('.selectpicker').html(countryHtml);
            $('.selectpicker').selectpicker('refresh');
        }
        var contentUrl = `https://transpanda.news/tpapi/rss_getglobalcontent.cfm?date=${currentDate}&keyword=${activeKeyword}&countries=${allCountry.toString()}&fromlink=${url}&from=1&to=50`;
        var globalContent = ajaxCall(contentUrl);
        if (globalContent.length > 0) {
            var contentHtml = '';
            $.each(globalContent, function (key, val) {
                contentHtml +=contentCard(val);
            });
            $('.check-global-section-2').html(contentHtml);
            window.__sharethis__.initialize();
        }else{
            $('.check-global-section-2').html('');
            window.__sharethis__.initialize();
        }
    })
    $(document).ready(function () {
        $(document).on('change', '.selectpicker', function () {
            var contentUrl = `https://transpanda.news/tpapi/rss_getglobalcontent.cfm?date=${currentDate}`;
            contentUrl += `&keyword=${getUrlParameter('keyword')}`;
            $('.selectpicker').each(function (){
                $('.selectpicker').each(function (){
                    if ($(this).val().length > 0){
                        contentUrl +=`&countries=${$(this).val().toString()}`;
                    }else{
                        contentUrl +=`&countries=${allCountry.toString()}`;
                    }
                });
            });
            contentUrl +=`&fromlink=${url}&from=1&to=50`;
            var globalContent = ajaxCall(contentUrl);
            if (globalContent.length > 0) {
                var contentHtml = '';
                $.each(globalContent, function (key, val) {
                    contentHtml +=contentCard(val);
                });
                $('.check-global-section-2').html(contentHtml);
                window.__sharethis__.initialize();
            }else{
                $('.check-global-section-2').html('');
                window.__sharethis__.initialize();
            }
        })
    })

    function contentCard(data){
        return `<div class="timeline-right-side-1">
                <div class="timeline-heading">
                  <a href="${data[3]}"><h4 class="timeline-title">${data[0]}</h4></a>
                  <div class="check-global-section-1-1 ms-auto">
                    <p>${data[7]}</p>
                    <div>
                    <span class="flag-icon flag-icon-${data[6]}" style="width:30px;"></span>
                    </div>
                  </div>
                </div>
                <div class="timeline-body">
                  <p>${data[1]}</p>
                  <h5>${data[8]}</h5>
                  <h5>${moment(new Date(data[4])).fromNow()}</h5>
                </div>
                <div class="timeline-heading-sub-1">
                  <a data-link="${data[3]}" href="check-globalneu.html?link=${data[3]}&date=${currentDate}&keyword=${activeKeyword}">Check global</a>
                  <h3 class="ms-auto"><i class="bi bi-circle-fill" style="color: ${data[10]}"></i>WPFI: ${data[9]}</h3>
                </div>
              </div>`;
    }
    function updateKeywordList(keywordList) {
        var keywordListHtml = '';
        $.each(keywordList, function (key, val) {
            if (val[0] !== '') {
                keywordListHtml += `<li class="key-class" data-value="${val[0]}">
                    <span>${val[0]}</span>
                    <i class="bi bi-x-lg"></i>
                  </li>`;
            }
        });
        $('#keyword-list').html(keywordListHtml);
    }

    function ajaxCall(url) {
        var data;
        $.ajax({
            url: url,
            method: 'GET',
            async: false,
            success: function (response) {
                data = response.DATA;
            }
        });
        return data;
    }

    var getUrlParameter = function getUrlParameter(sParam) {
        var sPageURL = window.location.search.substring(1),
            sURLVariables = sPageURL.split('&'),
            sParameterName,
            i;

        for (i = 0; i < sURLVariables.length; i++) {
            sParameterName = sURLVariables[i].split('=');

            if (sParameterName[0] === sParam) {
                return typeof sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
            }
        }
        return false;
    };

    $('#right-button').click(function () {
        event.preventDefault();
        $('.home-section-1-sub-1').animate({
            scrollLeft: "+=200px"
        }, "slow");
    });

    $('#left-button').click(function () {
        event.preventDefault();
        $('.home-section-1-sub-1').animate({
            scrollLeft: "-=200px"
        }, "slow");
    });


</script>
</body>
</html>
